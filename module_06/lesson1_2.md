# Ключи и отношения в базах данных

Сегодняшний наш герой - Владимир Александрович, директор школы. Недавно его школа значительно расширилась и теперь хранить всю информацию об учениках на бумаге стало неудобно, поэтому он решил разработать систему, в которой можно было бы удобно ставить оценки ученикам, вести учет рабочего времени преподавателей, хранить расписание занятий и т.д.

Владимир Александрович попросил нас помочь ему разработать базу данных для его школы.

## Разрабатываем базу данных

Для того, чтобы сделать это, давайте для начала разберемся какие сущности необходимо хранить в базе данных:

- Ученики (ФИО, пол, дата рождения, в каком классе учится, контактные данные ученика и родителей)
- Классы учеников (номер и литера класса, классный руководитель)
- Учителя (ФИО, ставка, какие предметы ведет, контактные данные)
- Предметы (название, в каких классах ведутся)

Информации довольно много, за раз все это сложно уложить в голове. Давайте начнем с учеников. Можно начать с вот такой таблицы (таблица "Ученики"):

| ФИО | Класс | Дата рождения |
| --- | ----- | ------------- |
| Авдеев Антон Антонинович | 7 "А" | 31.05.2008 |
| Сазонова Неолина Богдановна | 7 "А" | 30.04.2008 |
| Капустина Винетта Созоновна | 7 "А" | 29.03.2008 |
| Носкова Алла Ростиславовна | 9 "Б" | 28.06.2006 |
| Марков Оскар Викторович | 9 "Б" | 27.07.2006 |
| Тетерин Вениамин Антонович | 9 "Б" | 26.08.2006 |

Структура у таблицы очень простая и сразу понятно как с ней работать. Но что будет в конце года? Все, кто был в 7 "А" перейдут в 8 "А" и нам придется менять большое количество ячеек в таблице. Как этого можно избежать? На самом деле, ученик не привязан к своему классу навсегда (как, например, к своей дате рождения или к ФИО), поэтому название класса можно перенести в отдельную таблицу (назовем ее "Класс"):

| id | Название |
| -- | -------- |
| 1  | 1 "Д" |
| 2  | 7 "А" |
| 3  | 9 "Б" |
| 4  | 11 "В" |

Во-первых, теперь мы можем хранить классы даже если в них не учатся ученики. Во-вторых, мы добавили колонку `id`, и теперь если у нас будут два класса с одинаковым названием (например, занесли по ошибке), то мы сможем их отличить. Теперь мы можем связать при `id` новую таблицу с обновленной старой:

| id | ФИО | Класс_id | Дата рождения |
| -- | --- | -------- | ------------- |
| 1 | Авдеев Антон Антонинович | 2 | 31.05.2008 |
| 2 | Сазонова Неолина Богдановна | 2 | 30.04.2008 |
| 3 | Капустина Винетта Созоновна | 2 | 29.03.2008 |
| 4 | Носкова Алла Ростиславовна | 3 | 28.06.2006 |
| 5 | Марков Оскар Викторович | 3 | 27.07.2006 |
| 6 | Тетерин Вениамин Антонович | 3 | 26.08.2006 |

Теперь мы разбили таблицу на две более простые и избавились от возможных проблем с изменением данных. Если нам нужно будет перевести учеников в следующий класс, нужно будет лишь изменить название в таблице "Класс".

## Первичные и внешние ключи

Самое время ввести несколько терминов.

**Первичным ключом** называют поле (или набор полей) однозначно идентифицирующие строку в таблице. Создание первичных ключей в таблице - хорошая практика и многие СУБД по-умолчанию добавляют колонку `id` во все таблицы. Колонку `id` можно и не создавать, если гарантируется, что какое-то из полей (или набор полей) будет уникальным для каждой строки. Например, если бы мы делали таблицу с предметами, то название предмета было бы первичным ключом, так как в школе не могут быть два разных курса с одинаковым названием "математика". Однако даже в таком случае лучше сделать колонку `id`, чтобы всем было очевидно, что является первичным ключом таблицы.

**Внешним ключом** называют поле, по которому производится связь с другой таблицей. В нашем случае это колонка `Класс_id`. При необходимости две таблицы можно объединить, и тогда на место рядом с этой колонкой будет выведена соответствующая строка из таблицы "Класс".

## Отношения в базах данных

Когда две сущности связаны между собой, говорят, что между ними есть отношение одного из трех типов:

- One-to-one - одному объекту первого типа относится один объект второго типа. Например, ученик и его дата рождения.

- One-to-many (Many-to-one) - одному объекту первого типа относится много объектов второго типа. Например, ученик и его класс. В класс может входить множество учеников, но ученик только в одном классе

- Many-to-many - одному объекту может соответствовать множество других объектов, и наоборот. Например, учителя и предметы. Один учитель может вести несколько предметов, и каждый предмет может вести несколько учителей.

С первыми двумя типами мы разобрались выше, а вот с последним типом давайте разбираться.

Как правило, такой тип связей записывается при помощи промежуточной таблицы. Давайте для начала составим таблицы с учителями и предметами.

Таблица "Учитель":

| id | ФИО | Классный руководитель класса_id |
| -- | --- | ------------------------------- |
| 1 | Ершова Мэри Олеговна | 1 |
| 2 | Кошелева Серафима Леонидовна | 4 |
| 3 | Копылова Селена Геласьевна | 3 |
| 4 | Зыкова Стелла Петровна | 2 |

Таблица "Предмет":

| id | Название |
| -- | -------- |
| 1 | Математика |
| 2 | Русский язык |
| 3 | Биология |
| 4 | География |

А теперь давайте свяжем эти две таблицы. Таблица "Учитель-Предмет":

| id | Учитель_id | Предмет_id |
| -- | ---------- | ---------- |
| 1 | 1 | 1 |
| 2 | 1 | 2 |
| 3 | 2 | 2 |
| 4 | 3 | 4 |
| 5 | 4 | 1 |

Теперь используя эти три таблицы мы можем хранить информацию о том какие учителя какие предметы ведут. Например, сейчас мы видим, что учитель 1 ведет два предмета, а предмет 3 не ведет никто.
