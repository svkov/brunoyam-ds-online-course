# Функции

Когда мы пишем большую и сложную программу, в какой-то момент мы начнем теряться в ней. В 10 строках кода можно довольно быстро разобраться, на 20 строчек понадобится время, а в 30 и больше строках разбираться совсем сложно. Функции позволяют делить код на кусочки, что позволяет значительно сократить объем кода. Особенно функции эффективны, когда в коде много дублирований.

Функции обычно работают так - что-то принимают на вход, как-то это обрабатывают и отдают на выходе. Комбинируя между собой функции, можно собирать программу как лего, деталь за деталью.

Давайте напишем простого чат-бота, который запоминает список покупок, используя функции. Бот должен иметь такую функциональность:

- Добавить позицию в список покупок
- Убрать позицию из списка покупок
- Показать список покупок. Список покупок должен быть отсортирован в лексикографическом порядке (по алфавиту).

## Решаем задачу без функций

Давайте начнем решать задачу как решали до этого, без функций. Напишем общую структуру программы:

```python
command = None
shopping_list = {}
while True:
    command = input('Введите команду')
    if command == 'добавить':
        ...
    elif command == 'удалить':
        ...
    elif command == 'показать':
        ...
    elif command == 'выход':
        break
    else:
        print('Я вас не понял, введите одну из команд: [добавить, удалить, показать, выход]')
```

До тех пор, пока пользователь не введет "выход", мы будем спрашивать какие-то команды. Обратите внимание, что цикл по своей сути бесконечный, но мы добавили `break` и поэтому знаем когда точно цикл закончится. Получается, осталось реализовать три команды - добавить, удалить и показать. Давайте реализуем их отдельно.

Будем хранить список покупок в словаре. Ключ словаря будет наименованием предмета, а значение - количество. Если пользователь два раза введет какую-то позицию, то мы должны в итоге выдать сумму этих двух позиций. Например, если пользователь введет "шампунь 1" два раза, то на выходе должны получить "шампунь 2".

```python
...
if command == 'добавить':
    position = input('Введите название и количество через пробел')
    name, number = position.split()
    number = float(number)
    if name in shopping_list:
        shopping_list[name] += number
    else:
        shopping_list[name] = number
...
```

Обратите внимание, что мы не обрабатываем ввод пользователя и надеемся, что он действительно введет название и количество через пробел. Если что-то пойдет не так, программа упадет с ошибкой.

Давайте аналогично добавим удаление позиции из списка:

```python
...
elif command == 'удалить':
    position = input('Введите название позиции, которую хотите удалить')
    # Удаляем элемент из словаря
    shopping_list.pop(position, None)
...
```

Ну и давайте выведем список покупок:

```python
...
elif command == 'показать':
    # возьмем все ключи словаря и отсортируем в алфавитном порядке
    keys = sorted(shopping_list.keys())
    for key in keys:
        print(key, shopping_list[key])
...
```

Если все соединить в одну программу, то получится довольно большой кусок кода:

```python
command = None
shopping_list = {}
while True:
    command = input('Введите команду')
    if command == 'добавить':
        position = input('Введите название и количество')
        name, number = position.split()
        number = float(number)
        if name in shopping_list:
            shopping_list[name] += number
        else:
            shopping_list[name] = number
    elif command == 'удалить':
        position = input('Введите название позиции, которую хотите удалить')
        shopping_list.pop(position, None)
    elif command == 'показать':
        keys = sorted(shopping_list.keys())
        for key in keys:
            print(key, shopping_list[key])
    elif command == 'выход':
        break
    else:
        print('Я вас не понял, введите одну из команд: [добавить, удалить, показать, выход]')
```

Сходу разобраться в таком коде очень сложно. Для того, чтобы структурировать программу, давайте разберемся с функциями и вернемся к примеру с ботом.

## Пишем функции

Функции объявляются при помощи ключевого слова `def`. Функция может принимать какой-то входной параметр и возвращать какое-то значение. Например, мы можем написать функцию для сложения двух чисел:

```python
def sum_two_numbers(a, b):
    # получаем результат и возвращаем его
    return a + b
```

Входные параметры `a` и `b` называются **аргументами функции**.
Слово `return` используется, чтобы вернуть из функции какой-то результат. В нашем случае искомую сумму двух чисел.

Функция объявлена, но если запустить этот код, то ничего не произойдет. Мы должны вызвать функции, передав какие-то параметры, чтобы получить результат:

```python
sum_1 = sum_two_numbers(3, 4)
sum_2 = sum_two_numbers(5, 8)
print(sum_1, sum_2)
```

Функцию можно и нужно запускать с разными параметрами.

Давайте напишем еще одну функцию. Она будет увеличивать значение переменной на 1, пока значение не достигнет 3:

```python
number = 0

def increment():
    if number < 3:
        number += 1
```

Из функции мы можем обращаться к переменным, которые были объявлены вне функций. Также обратите внимание, что здесь мы не использовали `return`, потому что функция не должна ничего возвращать. Давайте запустим функцию несколько раз и посмотрим на результат:

```python
increment()
print(number) # 1

increment()
print(number) # 2

increment()
print(number) # 3

# Больше увеличиваться не будет
increment()
print(number) # 3
```

Итак, что нужно помнить про функции:

- Объявляются при помощи `def`
- У функции могут быть аргументы
- Функция может что-то возвращать при помощи слова `return`
- Функция может работать с переменными, объявленными вне функций
- Чтобы функция заработала, нужно вызвать ее в основной части программы

Хорошей практикой является делать функции как можно меньше, чтобы они выполняли какие-то атомарные действия. Если функция делает больше одного действия, то ее нужно разбивать на более мелкие функции.

Также если функция не зависит от переменных, объявленных вне функций, то в такой функции реже бывают ошибки, поэтому по возможности старайтесь все переменные, которые необходимы для работы функции, вынести в аргументы.

## Рекурсия

Если мы пишем код, который должен решать математическую задачу, то нам может понадобиться вызвать функцию внутри самой себя.

Самый простой пример - подсчет факториала. Факториал определяется так:

$$
factorial(n) =
\begin{cases}
1, n = 0, 1 \\
n * factorial(n - 1)
\end{cases}
$$

По сути, это означает, что мы перемножим все числа меньшие $n$ между собой. Запрограммируем эту функцию:

```python
def factorial(n):
    if n == 0 or n == 1:
        return 1
    # если 2 и больше
    return n * factorial(n - 1)
```

Конечно, можно было написать цикл для решения этой задачи, но иногда рекурсивные решения выглядят элегантнее.

Доказано, что любой рекурсивный алгоритм можно переписать с помощью цикла.

## Вернемся к чат-боту

Какие функции мы можем выделить? Например, такие:

- добавление к списку
- удаление из списка
- показать список

Давайте напишем эти функции:

```python
def add_position(shopping_list):
    # Что можно улучшить в этой функции?
    position = input('Введите название и количество')
    name, number = position.split()
    number = float(number)
    if name in shopping_list:
        shopping_list[name] += number
    else:
        shopping_list[name] = number
    return shopping_list


def remove_position(shopping_list):
    position = input('Введите название позиции, которую хотите удалить')
    shopping_list.pop(position, None)
    return shopping_list


def show_shopping_list(shopping_list):
    keys = sorted(shopping_list.keys())
    for key in keys:
        print(key, shopping_list[key])
```

Все функции независимы друг от друга, разобраться с каждой функцией по отдельности намного проще. Давайте теперь изменим основной код программы:

```python

command = None
shopping_list = {}
while True:
    command = input('Введите команду')
    if command == 'добавить':
        shopping_list = add_position(shopping_list)
    elif command == 'удалить':
        shopping_list = remove_position(shopping_list)
    elif command == 'показать':
        show_shopping_list(shopping_list)
    elif command == 'выход':
        break
    else:
        print('Я вас не понял, введите одну из команд: [добавить, удалить, показать, выход]')
```

Код программы также сократился и стал гораздо понятнее. Но этот код не идеален. Попробуйте сделать следующее:

- Принт в конце выбивается из общей картины, его тоже можно сделать функцией
- Конструкция с кучей if выглядит громоздко. Ее можно вынести в отдельную функцию, которая на вход принимает команду и делает все необходимые действия
- При добавлении нескольких позиций подряд приходится постоянно вводить "добавить". Как можно упростить добавление новых позиций? Будет ли это сложно реализовать, используя все имеющиеся функции? Было бы это сложнее добавить, если бы мы не использовали функции?
