# Работа с файлами

На протяжении курса мы постоянно будем работать с файлами. Обычно нам в этом будут помогать библиотеки, но не для всех форматов файлов реализованы функции чтения и записи.

Запись информации в файл позволяет сохранять информацию между запусками программы. Давайте представим, что мы пишем игру, и нам необходимо сохранять рекорды игрока. Если не записывать их в файл, то при каждом запуске игры рекорды будут обнуляться, но если мы сможем настроить запись рекордов в файл, то единожды получив рекорд, он будет храниться в файле до тех пор, пока его оттуда не удалят.

## Функция open

Функция `open` очень простая, но в тоже время довольно коварная. Давайте разбираться как с ней работать.

Эта функция позволяет открыть файл и проводить над ним какие-то операции. Базово работа с ней выглядит так:

```python
# Запишем в файл рекорд Васи
highscore_file = open('highscore.txt', 'w')
highscore_file.write('Вася 100')
# Необходимо ВСЕГДА закрывать за собой файлы. Если этого не сделать, то можно столкнуться с ошибками
# Сохранение происходит именно в момент закрытия
# Операционная система постарается закрыть за вас файл, если вы забудете, но это не всегда работает правильно
highscore_file.close()

# Прочитаем тот же файл
highscore_file = open('highscore.txt', 'r')
highscores = highscore_file.read() # Вася 100
highscore_file.close()
```

Итак, что произошло?

- Сначала нужно открыть файл при помощи функции `open` первым аргументом нужно указать путь до файла, а ко второму аргументу мы вернемся позже
- Затем необходимо сделать все дела с файлом - прочитать/записать значения
- В конце необходимо закрыть файл. Если этого не сделать и кто-то изменит файл до завершения программы, то можно столкнуться с проблемами.

Теперь вернемся ко второму аргументу. В случае записи мы указали `w`, а в случае чтения `r`. На самом деле, это флаг, который показывает что мы собираемся сделать с файлом. Какие бывают флаги [можно прочитать в документации](https://docs.python.org/3/library/functions.html#open), мы разберемся с основными:

- `r` (read) - флаг для чтения файла. Операции записи будут недоступны
- `w` (write) - флаг для записи файлов. Содержимое файла удалится и на его месте появится все, что вы туда запишете.
- `a` (append) - флаг для записи в конец файла.
- `b` (bytes) - если вы хотите прочитать/записать бинарные файлы (например, картинку), то следует использовать этот флаг рядом с остальными, например для чтения картинки следует использовать `open('pic.jpg', 'rb')`

Давайте вернемся к нашему файлу и откроем его в любом текстовом редакторе (например, в Блокноте). Скорее всего, вы увидите там что-то такое:

`���� 100`

Почему так произошло? Дело в том, что мы использовали в тексте кириллицу, но не указали кодировку. Давайте исправим ошибку и укажем кодировку при записи файла. Кириллица есть, например, в кодировке `utf-8`:

```python
highscore_file = open('highscore.txt', 'w', encoding='utf-8')
highscore_file.write('Вася 100')
highscore_file.close()
```

Теперь снова открываем файл и видим там заветные:

`Вася 100`

## Как проще работать с файлами

Постоянно открывать-закрывать файлы утомительно. Хорошо, что разработчики языка предусмотрели конструкцию `with`, которая позволяет автоматически закрывать файл:

```python
with open('highscore.txt', 'r', encoding='utf-8') as file:
    content = file.read()
    # делаем все необходимое
    ...
```

После окончания блока `with` файл закроется автоматически. Это очень удобно и безопасно. Предпочтительно использовать такую запись.
