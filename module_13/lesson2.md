# Преобразование Фурье

## Частотные подходы к анализу временных рядов

Помимо модели ARIMA существуют другие подходы к моделированию временных рядов.

Чаще всего мы можем успешно прогнозировать временные ряды только если они повторяются на каких-то промежутках. Соответственно, можно моделировать временные ряды как сумму периодических функций (например, синусов и косинусов).

$f(x) = \frac{a_0}{2} +  \sum_{i=1}^{n} a_i cos(ix) + b_i sin(ix)$

Такие функции называются рядами Фурье.

Существует теорема о том, что любую непрерывную функцию можно в точности описать рядом Фурье. На практике это означает, что можно смоделировать с нужной точностью любой временной ряд (по-крайней мере, обучающую выборку). Для того, чтобы раскладывать сигналы в ряд Фурье, обычно используют преобразование Фурье. Преобразование Фурье позволяет перейти от координат время-значение к координатам частота-амплитуда. Важно, что при после преобразования Фурье получаются комплексные числа, но мы можем использовать их угол и длину (фаза и амплитуда), чтобы свести все к вещественным числам.

Создадим сигнал из двух косинусов

```python
from scipy.fft import fft, ifft, fftfreq

n = 500
t = 1 / 10
x = np.linspace(0, n * t, n)
y = 2 * np.cos(x * np.pi * 2 * 0.5) + 10 * np.cos(x * np.pi * 2 * 3)

plt.plot(x, y)
```

**вставить картинку**

А вот так этот же сигнал будет выглядеть после преобразования Фурье

```python
yf = fft(y)
xf = fftfreq(n, t)[:n//2]
plt.plot(xf, 2 / n * np.abs(yf[:n//2]))
```

**вставить картинку**

Наши данные имели нулевое среднее. Если бы это было не так, то в нуле также был бы пик. Чтобы этого избегать, необходимо использовать StandardScaler перед применением преобразования Фурье.

## Фильтры на основе преобразования Фурье

Если применять преобразование Фурье на реальных данных, то можно увидеть, что исходный сигнал часто будет зашумлен. Можно убирать шум и таким образом делать данные чище и понятнее. Для этого нужно сделать нулевыми нужные частоты, после чего сделать обратное преобразование.

Выделяют следующие виды фильтров:

- Низкочастотный фильтр - убирает высокие частоты, оставляет низкие. Можно использовать, если хочется посмотреть на глобальный тренд в данных.
- Высокочастотный фильтр - убирает низкие частоты, оставляет высокие. Можно использовать, если нужно избавиться от тренда и посмотреть на изменение ряда в коротком отрезке. Редко используется, потому что обычно в высоких частотах находится шум.
- Полосовой фильтр - убирает все частоты, кроме указанных. Можно использовать, если нужно исследовать определенные частоты. Например, если хочется посмотреть на недельную или годовую сезонность.

## Прогнозирование при помощи преобразование Фурье

Так как после преобразования Фурье мы получаем описание временного ряда при помощи аналитических функций, то мы можем использовать эту же формулу, чтобы продолжить ряд.

Важно, чтобы в данных было как меньше тренда (его можно вычесть, а после получения прогноза прибавить). А также важно, чтобы у нас была информация о том, сколько идет один цикл внутри ряда. Например, если мы видим, что продажи выглядят примерно одинаково внутри каждого года, за исключением общего тренда, то мы можем вычесть этот тренд, а затем на последнем годе применить прогнозирование при помощи преобразования Фурье.

Также в данных может быть шум и будет лучше, если мы уберем слишком высокие частоты. Как понять какие частоты достаточно высокие для того, чтобы их убирать? Можно взять первые 10 гармоник (слагаемых в преобразование), и посмотреть, насколько хорошо данные описываются такой функцией. Если плохо, то увеличиваем количество гармоник. Если описывается хорошо, то можно сделать меньше гармоник.

Алгоритм называется [экстраполяция Фурье и доступен на гитхабе](https://gist.github.com/tartakynov/83f3cd8f44208a1856ce).

## [Вейвлет-преобразование](https://ru.wikipedia.org/wiki/%D0%92%D0%B5%D0%B9%D0%B2%D0%BB%D0%B5%D1%82-%D0%BF%D1%80%D0%B5%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)

Вейвлет-преобразование является обобщением преобразования Фурье. Вместо синусов и косинусов мы используем [вейвлеты](https://ru.wikipedia.org/wiki/%D0%92%D0%B5%D0%B9%D0%B2%D0%BB%D0%B5%D1%82). Считается, что вейвлеты лучше описывают реальные данные.

С помощью вейвлет-преобразования можно получить несколько более простых по структуре рядов, которые более вероятно окажутся стационарными и которые мы можем прогнозировать обычной ARIMA и ее модификациями. [Это описано, например, здесь](https://www.sciencedirect.com/science/article/pii/S095741741500041X?casa_token=AjNUopbTGk4AAAAA:5C3_S8lrXha90xQ8teHKrD-NlkPHZTeaPX1LuA0k56psTQ5y6TvykvXzKD9HZcykZ3dxni_oyGQ)

При помощи вейвлет-преобразования можно прогнозировать временные ряды и проводить фильтрацию, но это требует более глубокого погружения.
